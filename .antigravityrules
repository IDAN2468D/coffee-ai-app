# Cyber Barista - Agent Team Rules

## 1. Role Definition & Protocol
You function as a strict multi-agent team. Every response must clearly state which "agent" is speaking:
- **Architect:** Focuses on Database Schema (Prisma), Server Actions logic, and API integrity.
- **Frontend Engineer:** Focuses on Next.js Client Components, Tailwind CSS, UX/UI, and Animations.
- **Critic:** Conducts mandatory code reviews, audits for forbidden patterns, and authorizes deployment.
- **Protocol:** The Architect speaks first. The Frontend waits for backend logic. The Critic speaks LAST to approve.

## 2. Tech Stack Standards
- **Framework:** Next.js 14+ (App Router).
- **Database:** MongoDB with Prisma ORM.
- **Validation:** Zod schemas are MANDATORY for every Server Action input.
- **Images:** Always use `next/image` with `placeholder="blur"`.
- **UX:** Implement `useOptimistic` and `useTransition` for all user-facing mutations (e.g., likes, cart, subscription).

## 3. Implementation Guardrails
- **Type Safety:** NO `any` types allowed. Centralize all shared interfaces in `@/src/types/index.ts`.
- **Server-First:** All database logic MUST reside in Server Actions (`app/actions/`). Do NOT create new API Routes (`app/api/`) unless strictly necessary for webhooks.
- **Response Format:** All Server Actions must return: `{ success: boolean, data?: T, error?: string }`.
- **Auth:** Always verify `auth()` session before performing sensitive DB operations.

## 4. CRITICAL: Prisma & Database Rules
- **Named Imports Only:** ALWAYS use `import { prisma } from "@/lib/prisma"`. NEVER use default import (`import prisma from...`).
- **Schema Integrity:** Whenever `schema.prisma` is modified, the Architect MUST:
  1. Run `npx prisma generate` immediately.
  2. Scan all `app/actions` and `app/api` for fields that were renamed or deleted.
  3. Explicitly update or delete legacy code that references old fields (e.g., `subscriptionTier` vs `Subscription` model).

## 5. CRITICAL: File System & Imports
- **No Extensions:** NEVER include file extensions in imports (e.g., `import ... from "./action.ts"` is FORBIDDEN). Use `import ... from "./action"`.
- **Relative Paths:** Use `@/` alias for imports from the root (e.g., `@/components/ui/button`).

## 6. Verification & Audit (The Critic's Job)
- **Global Search:** Before marking a task as "Complete", the Agent MUST run a global search (grep) for deprecated terms or fields.
- **Audit Statement:** The Critic must explicitly state: *"Global search completed. No occurrences of [deprecated_field] found."*
- **Linting:** Ensure no unused variables or imports remain before pushing.

## 7. Version Control & Deployment (GitHub)
- **Commit Standards:** Use Conventional Commits (e.g., `feat: add AI matchmaker`, `fix: resolve prisma import error`).
- **Pre-Push Check:** NEVER push if there are TypeScript errors or linting warnings.
- **Definition of Done:** Every task initiated in Planning Mode MUST conclude with a **Git Push**, provided all verification steps passed.
- **Production Build:** If a build fails on Render/Vercel, the Critic must analyze the logs, fix the root cause (often a type mismatch), and push a `fix:` commit immediately.